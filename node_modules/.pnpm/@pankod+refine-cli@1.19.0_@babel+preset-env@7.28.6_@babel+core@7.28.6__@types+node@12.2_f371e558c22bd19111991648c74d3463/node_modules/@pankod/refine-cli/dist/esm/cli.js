#!/usr/bin/env node
var wt=Object.defineProperty;var M=(e=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(e,{get:(t,r)=>(typeof require!="undefined"?require:t)[r]}):e)(function(e){if(typeof require!="undefined")return require.apply(this,arguments);throw new Error('Dynamic require of "'+e+'" is not supported')});var yt=(e,t)=>{for(var r in t)wt(e,r,{get:t[r],enumerable:!0})};import{fileURLToPath as Tt}from"url";import Ct from"path";var Et=()=>Tt(import.meta.url),Pt=()=>Ct.dirname(Et()),a=Pt();import{Command as Eo}from"commander";import Po from"figlet";import Rt from"react";import{render as $t}from"ink";import{readFileSync as St,existsSync as bt,readJSON as Nt,pathExists as he}from"fs-extra";import vt from"globby";import xe from"execa";import Ot from"preferred-pm";import It from"ora";var kt=async(e,t)=>{let r=It({color:"cyan",text:t}).start(),n=await e();return r.stop(),n},j=kt;var W=()=>{if(!bt("package.json"))throw new Error("./package.json not found");return JSON.parse(St("package.json","utf8"))},H=()=>{let e=W();return Object.keys(e.dependencies||{})};var we=()=>{let e=W();return Object.keys(e.devDependencies||{})},Z=()=>W().scripts,R=async()=>{var e;try{let t=await xe("npm",["ls","--depth=0","--json"],{reject:!1}),r=((e=JSON.parse(t.stdout))==null?void 0:e.dependencies)||{},n=Object.keys(r).filter(s=>s.startsWith("@pankod/refine")),o=[];for(let s of n){let m=r[s].version;o.push({name:s,version:m})}return o}catch{return Promise.resolve(null)}},ye=async()=>{try{let e=await vt("node_modules/@pankod/refine-*",{onlyDirectories:!0}),t=[];return await Promise.all(e.map(async r=>{if(await he(`${r}/package.json`)){let o=await Nt(`${r}/package.json`);t.push({name:o.name,path:r})}})),t}catch{return[]}},Te=async e=>await he(`${e}/refine.config.js`),J={npm:{install:["install","--save"],installDev:["install","--save-dev"],outdatedJson:["outdated","--json"]},yarn:{install:["add"],installDev:["add","-D"],outdatedJson:["outdated","--json"]},pnpm:{install:["add"],installDev:["add","-D"],outdatedJson:["outdated","--format","json"]}},D=async()=>{let e=await j(()=>Ot(process.cwd()),"Getting package manager...");if(!e)throw new Error("Package manager not found.");return e},Ce=async e=>{let t=await D();try{let r=J[t.name].install,n=xe(t.name,[...r,...e],{stdio:"inherit"});n.on("message",o=>{console.log(o)}),n.on("error",o=>{console.log(o)}),n.on("exit",o=>{if(o===0){console.log("All `refine` packages updated  \u{1F389}");return}console.log(`Application exited with code ${o}`)})}catch(r){throw new Error(r)}},Ee=e=>{let t=e.lastIndexOf("@");return t<=0?{name:e,version:null}:{name:e.slice(0,t),version:e.slice(t+1)}};import E,{useRef as Pe}from"react";import _t from"ink-table";import{Box as Dt,Text as N}from"ink";var Ie={name:1,current:2,wanted:3,latest:4},At=4,oe=e=>{let t=e.split(".");return{major:t[0],minor:t[1],patch:t[2]}},ke=(e,t)=>e.major.trim()!==t.major.trim()?{major:"red",minor:"red",patch:"red"}:e.minor.trim()!==t.minor.trim()?{major:"white",minor:"yellow",patch:"yellow"}:e.patch.trim()!==t.patch.trim()?{major:"white",minor:"white",patch:"green"}:{major:"white",minor:"white",patch:"white"},jt=({data:e,command:t})=>{let r=Pe(1),n=Pe(0);return E.createElement(Dt,{width:"100%",flexDirection:"column",alignItems:"center",justifyContent:"center"},E.createElement(N,null,"Update Available"),E.createElement(_t,{data:e,cell:o=>{var h;let s=E.createElement(N,null,o.children),m=(h=o.children)==null?void 0:h.toString();if(!m)return s;let f=oe(e[n.current].current);if(r.current===Ie.wanted){let p=oe(m),l=ke(f,p);s=E.createElement(Se,{major:{color:l.major,text:p.major},minor:{color:l.minor,text:p.minor},patch:{color:l.patch,text:p.patch}})}if(r.current===Ie.latest){let p=oe(m),l=ke(f,p);s=E.createElement(Se,{major:{color:l.major,text:p.major},minor:{color:l.minor,text:p.minor},patch:{color:l.patch,text:p.patch}})}return r.current===At?(n.current+=1,r.current=1):r.current+=1,s}}),E.createElement(N,null,"To update ",E.createElement(N,{bold:!0},"`refine`")," packages with the wanted version"),E.createElement(N,null,"Run the following command"," ",E.createElement(N,{color:"yellowBright"},t)))},Se=({major:e,minor:t,patch:r})=>E.createElement(N,null,E.createElement(N,{color:e.color},e.text),E.createElement(N,{color:t.color},".",t.text,"."),E.createElement(N,{color:r.color},r.text)),be=jt;var Ut=async()=>{let e="npx @pankod/refine-cli update",t=H(),r=Object.keys(Z()),n=t.includes("@pankod/refine-cli"),o=r.includes("refine");if(!n&&!o)return e;let s=await D();return o?`${s.name} run refine update`:n?"npx refine update":e},Q=async e=>{let t=await Ut();$t(Rt.createElement(be,{data:e,command:t}))};import zt from"execa";import Ft from"semver-diff";var Bt=e=>e.command("check-updates").description("Check all installed `refine` packages are up to date").action(Vt),Vt=async()=>{let e=await j(q,"Checking for updates...");if(!e.length){console.log("All `refine` packages are up to date \u{1F389}\n");return}await Q(e)},q=async()=>await Lt(),Lt=async()=>{let e=await Mt();if(!e)return[];let t=[];return Object.keys(e).forEach(n=>{let o=e[n];n.includes("@pankod/refine")&&t.push({name:n,current:o.current,wanted:o.wanted,latest:o.latest})}),t.filter(n=>!!Ft(n.current,n.latest))},Mt=async()=>{let e="npm",{stdout:t,timedOut:r}=await zt(e,J[e].outdatedJson,{reject:!1,timeout:25e3});if(r)throw new Error("Timed out while checking for updates.");return t?JSON.parse(t):null},Ne=Bt;import{copySync as Kt,unlinkSync as Gt,moveSync as Zt,pathExistsSync as je,mkdirSync as Qt}from"fs-extra";import ae from"temp";import{plural as er}from"pluralize";import tr from"execa";import rr from"inquirer";import{join as Re}from"path";var X=(s=>(s.REACT_SCRIPT="react-scripts",s.REMIX="remix",s.NEXTJS="nextjs",s.VITE="vite",s.CRACO="craco",s))(X||{});var ne=(o=>(o.ANTD="antd",o.MUI="mui",o.MANTINE="mantine",o.CHAKRA="chakra-ui",o))(ne||{});var ve=(n=>(n.NPM="npm",n.YARN="yarn",n.PNPM="pnpm",n))(ve||{});var C=()=>{let e=H();if(e.includes("@craco/craco"))return"craco";if(e.includes("react-scripts"))return"react-scripts";if(e.includes("next"))return"nextjs";if(e.includes("@remix-run/react"))return"remix";if(we().includes("vite"))return"vite";throw new Error("Project type not found")},Oe=()=>{let e=H();if(e.includes("@pankod/refine-antd"))return"antd";if(e.includes("@pankod/refine-mui"))return"mui";if(e.includes("@pankod/refine-chakra-ui"))return"chakra-ui";if(e.includes("@pankod/refine-mantine"))return"mantine"};import $ from"handlebars";import{readFileSync as Wt,readdirSync as Ht,createFileSync as Jt,writeFileSync as qt,unlinkSync as Xt}from"fs-extra";var Yt=(e,t)=>{let r=Wt(e);return $.registerHelper("ifIn",function(o,s,m){return o.includes(s)?m.fn($):m.inverse($)}),$.registerHelper("formatInferencerComponent",function(o){if(!!o)switch(o){case"chakra-ui":return"ChakraUI";default:return o.charAt(0).toUpperCase()+o.slice(1)}}),$.registerHelper("capitalize",function(o){if(!!o)return o.charAt(0).toUpperCase()+o.slice(1)}),$.compile(r.toString())(t)},_e=(e,t)=>{Ht(e).forEach(n=>{let o=`${e}/${n}`,s=`${e}/${n.replace(".hbs","")}`;Jt(s),qt(s,Yt(o,t)),Xt(o)})};var De=e=>e.charAt(0).toUpperCase()+e.slice(1);var se=e=>{switch(e){case"nextjs":return{path:"src/components",alias:"../src/components"};case"remix":return{path:"app/components",alias:"~/components"}}return{path:"src/pages",alias:"pages"}},Ae=e=>{switch(e){case"remix":return"./app";case"nextjs":case"react-scripts":case"vite":case"craco":default:return"./src"}};var ie=["list","create","edit","show"],or=e=>{let t=C(),{path:r}=se(t);return e.command("create-resource").allowExcessArguments(!0).description("Create a new resource files").option("-a, --actions [actions]","Only generate the specified actions. (ex: list,create,edit,show)","list,create,edit,show").option("-p, --path [path]","Path to generate the resource files",r).action(nr)},nr=async(e,t)=>{let{args:r}=t,n=e.actions;if(!r.length){let{name:o,selectedActions:s}=await rr.prompt([{type:"input",name:"name",message:"Resource Name",validate:m=>m?!0:"Resource Name is required"},{type:"checkbox",name:"selectedActions",message:"Select Actions",choices:ie,default:e.actions.split(",")}]);r=[o],n=s.join(",")}r.forEach(o=>{let s=n?n.split(","):void 0,{path:m,alias:f}=se(C()),h=er(o).toLowerCase(),p=Re(process.cwd(),m,h);if(je(p)){console.error(`Resource (${Re(m,h)}) already exist! \u274C`);return}let l=De(o),I=Oe(),A=`${a}/../templates/resource`,b=sr();Kt(A,b);let i={resourceName:o,resource:l,actions:s||ie,uiFramework:I};_e(b,i),s&&ie.forEach(k=>{s.includes(k)||Gt(`${b}/${k}.tsx`)}),Qt(e.path,{recursive:!0});let d=`${e.path}/${h}`,u={};je(d)&&(u={overwrite:!0}),Zt(b,d,u),ae.cleanupSync();let y=M.resolve(".bin/jscodeshift"),{stderr:x,stdout:w}=tr.sync(y,["./","--extensions=ts,tsx,js,jsx","--parser=tsx",`--transform=${a}/../src/transformers/resource.ts`,"--ignore-pattern=**/.cache/**","--ignore-pattern=**/node_modules/**","--ignore-pattern=**/build/**","--ignore-pattern=**/.next/**",`--__actions=${i.actions}`,`--__pathAlias=${f}`,`--__resourceFolderName=${h}`,`--__resource=${l}`,`--__resourceName=${o}`]);x&&console.log(x),console.log(`Resource (${d}) generated successfully! \u{1F389}`)})},sr=()=>(ae.track(),ae.mkdirSync("resource")),$e=or;import ir from"envinfo";import ar from"ora";var cr=e=>e.command("whoami").description("View the details of the development environment").action(pr),pr=async()=>{let e=ar("Loading environment details...").start(),t=await ir.run({System:["OS","CPU"],Binaries:["Node","Yarn","npm"],Browsers:["Chrome","Firefox","Safari"]},{showNotFound:!0,markdown:!0}),n=(await R()||[]).map(o=>` - ${o.name}: ${o.version}`).join(`
`);e.stop(),console.log(t),console.log("## Refine Packages:"),console.log(n)},Ue=cr;import{Option as ur}from"commander";import Y from"inquirer";import Fe from"semver-diff";import ce from"chalk";var ze=e=>{let t=e.filter((n,o)=>e.indexOf(n)!==o),r=new Set(t);return Array.from(r)};var Be=async e=>{let t=lr(e);if(!t){console.log("All `refine` packages are up to date. \u{1F389}");return}let r=dr(t),n=await Y.prompt([{type:"checkbox",name:"packages",message:"Choose packages to update",pageSize:r.pageSize,choices:r.choices,validate:mr}]);return n.packages.length>0?n.packages:null},mr=e=>{let r=e.map(o=>Ee(o)).map(o=>o.name),n=ze(r);return n.length>0?`You can't update the same package more than once. Please choice one.
 Duplicates: ${n.join(", ")}`:!0},lr=e=>{if(e.length===0)return null;let t={patch:[],minor:[],major:[]};return e.forEach(r=>{let n=r.current,o=Fe(n,r.wanted),s=Fe(n,r.latest);if(o===s&&s){t[s].push({name:r.name,from:n,to:r.latest});return}o&&t[o].push({name:r.name,from:n,to:r.wanted}),s&&t[s].push({name:r.name,from:n,to:r.latest})}),t},dr=e=>{let t=0,r=0;[e.patch,e.minor,e.major].forEach(p=>{p.forEach(l=>{l.name.length>t&&(t=l.name.length),l.from.length>r&&(r=l.from.length)})}),t+=2;let n=[],o="Package".padEnd(t),s="From".padEnd(r),f=`
   ${o} ${s}${"To".padStart(r)}`;n.push(new Y.Separator(f)),e.patch.length>0&&(n.push(new Y.Separator(ce.reset.bold.blue(`
Patch Updates`))),e.patch.forEach(p=>{n.push({name:`${p.name.padEnd(t)} ${p.from.padStart(r)} -> ${p.to}`,value:`${p.name}@${p.to}`})})),e.minor.length>0&&(n.push(new Y.Separator(ce.reset.bold.blue(`
Minor Updates`))),e.minor.forEach(p=>{n.push({name:`${p.name.padEnd(t)} ${p.from.padStart(r)} -> ${p.to}`,value:`${p.name}@${p.to}`})})),e.major.length>0&&(n.push(new Y.Separator(ce.reset.bold.blue(`
Major Updates`))),e.major.forEach(p=>{n.push({name:`${p.name.padEnd(t)} ${p.from.padStart(r)} -> ${p.to}`,value:`${p.name}@${p.to}`})}));let h=n.length+6;return{choices:n,pageSize:h}};var fr=e=>e.command("update").description("Interactively select and update all `refine` packages to selected version. To skip the interactive mode, use the `--all` option.").addOption(new ur("-t, --tag [tag]","Select version to update to.").choices(["next","latest"]).default("wanted","Version ranges in the `package.json` will be installed")).option("-a, --all","Update all `refine` packages to the selected `tag`. If `tag` is not provided, version ranges in the `package.json` will be installed. This option skips the interactive mode.",!1).option("-d, --dry-run","Get outdated packages installation command without automatic updating. If `tag` is not provided, version ranges in the `package.json` will be used.",!1).action(gr),gr=async e=>{let{tag:t,dryRun:r,all:n}=e,o=await j(q,"Checking for updates...");if(!(o!=null&&o.length)){console.log("All `refine` packages are up to date \u{1F389}");return}let s=n?hr(t,o):await Be(o);if(!!s){if(r){xr(s);return}wr(s)}},hr=(e,t)=>e==="wanted"&&t.every(o=>o.current===o.wanted)?(console.log("All `refine` packages are up to date with the wanted version \u{1F389}"),null):t.map(n=>{let o=e==="wanted"?n.wanted:e;return`${n.name}@${o}`}),xr=async e=>{let t=await D(),r=J[t.name].install;console.log(`${t.name} ${r.join(" ")} ${e.join(" ")}`)},wr=e=>{console.log("Updating `refine` packages..."),console.log(e),Ce(e)},Ve=fr;import Ur from"react";import{render as zr}from"ink";import tt from"path";import z from"chalk";import te from"inquirer";import Fr from"inquirer-autocomplete-prompt";import{ensureFile as Br,pathExists as rt,readFile as Vr,writeFile as Lr}from"fs-extra";import Xe from"path";import kr from"path";var pe={};yt(pe,{PackageManagerTypes:()=>ve,ProjectTypes:()=>X,UIFrameworks:()=>ne,appendAfterImports:()=>He,getFileContent:()=>ee,getImports:()=>U,getNameChangeInImport:()=>Me});var yr=/import(?:(?:(?:[ \n\t]+([^ *\n\t\{\},]+)[ \n\t]*(?:,|[ \n\t]+))?([ \n\t]*\{(?:[ \n\t]*[^ \n\t"'\{\}]+[ \n\t]*,?)+\})?[ \n\t]*)|[ \n\t]*\*[ \n\t]*as[ \n\t]+([^ \n\t\{\}]+)[ \n\t]+)from[ \n\t]*(?:['"])([^'"\n]+)(?:['"])(?:;?)/g,Tr=/((?:\w|\s|_)*)( as )((?:\w|\s|_)*)( |,)?/g,U=e=>{let t=e.matchAll(yr),r=[];for(let n of t){let[o,s,m,f,h]=n;r.push({statement:o,importPath:h,...s&&{defaultImport:s},...m&&{namedImports:m},...f&&{namespaceImport:f}})}return r==null?void 0:r.filter(Boolean)},Me=e=>{let t=e.matchAll(Tr),r=[];for(let n of t){let[o,s,m,f,h]=n;r.push({statement:o,fromName:s.trim(),toName:f.trim(),afterCharacter:h})}return r},Cr=(e,t)=>{var s;let r=e.substring(0,e.indexOf(t.statement)),n=U(r).pop();return n?r.substring(r.indexOf(n==null?void 0:n.statement)+((s=n==null?void 0:n.statement)==null?void 0:s.length)):r},Er=(e,t)=>!!(t?Cr(e,t):"").trim(),Le=["react","@pankod/refine-core","@pankod/refine-"],We=e=>{var b;let t=e,r=U(e),n=r.filter(i=>!i.statement.includes("import type ")),o=r.filter(i=>i.statement.includes("import type")),s=[],m=[];n.forEach(i=>{Er(e,i)?s.push(i):m.push(i)});let f=t.indexOf((b=m==null?void 0:m[0])==null?void 0:b.statement);m.forEach(i=>{t=t.replace(i.statement,"")}),o.forEach(i=>{t=t.replace(i.statement,"")});let h=m.reduce((i,d)=>{let{importPath:u}=d;return i[u]?i[u].push(d):i[u]=[d],i},{}),I=[...Object.entries(h).map(([i,d])=>{let u=d.find(k=>k.defaultImport),y=d.find(k=>k.namespaceImport),x=d.filter(k=>k.namedImports).map(k=>{var re;return((re=k.namedImports)!=null?re:"").replace(/{|}/g,"").trim().split(",").map(G=>G.trim()).filter(Boolean).join(", ")}).join(", "),w="";return y&&(w+=y.statement+`
`),(u||x)&&(u&&x?w+=`import ${u.defaultImport}, { ${x} } from "${d[0].importPath}";
`:u?w+=`import ${u.defaultImport} from "${d[0].importPath}";
`:w+=`import { ${x} } from "${d[0].importPath}";
`),[i,w]})].sort(([i],[d])=>{let u=Le.findIndex(x=>i.includes(x)),y=Le.findIndex(x=>d.includes(x));return u===y?i.localeCompare(d):u===-1?1:y===-1?-1:u-y}).map(([,i])=>i).join(""),A=o.map(i=>i.statement).join(`
`);return t=t.substring(0,f)+I+A+t.substring(f),t};var He=(e,t)=>{let r=U(e),n=r[r.length-1],o=n?e.indexOf(n.statement):e.length-1;return e.slice(0,o+(n==null?void 0:n.statement.length))+`
`+t+`
`+e.slice(o+(n==null?void 0:n.statement.length))};import{readFileSync as Pr}from"fs-extra";import{join as Ir}from"path";function ee(e){if(!!(this!=null&&this.absolutePackageDir))try{return Pr(Ir(this.absolutePackageDir,e)).toString()}catch{return}}var Je=M("module"),Sr=Je.prototype.require,qe=(e,t)=>{Je.prototype.require=function(...r){return r[0]==="@pankod/refine-cli"?{...pe,getFileContent:n=>ee.call({absolutePackageDir:t?e:kr.join(process.cwd(),e)},n)}:Sr.apply(this,r)}};var Ye=async(e,t)=>{try{return qe(e,t),M(Xe.join(t?e:Xe.join(process.cwd(),e),"refine.config.js"))}catch{return}};import{format as br,resolveConfig as Nr}from"prettier";var Ke=async e=>{try{let t=await Nr(process.cwd());return br(e,{...t!=null?t:{},parser:"typescript"})}catch{return e}};import g from"react";import Ar from"ink-markdown";import jr from"dedent";import{Box as Rr,Text as T}from"ink";var P={SUCCESS:"SUCCESS",UNKNOWN_ERROR:"UNKNOWN_ERROR",SOURCE_PATH_NOT_FOUND:"SOURCE_PATH_NOT_FOUND",TARGET_PATH_NOT_FOUND:"TARGET_PATH_NOT_FOUND",SOURCE_PATH_NOT_A_FILE:"SOURCE_PATH_NOT_A_FILE",TARGET_ALREADY_EXISTS:"TARGET_ALREADY_EXISTS"};import vr from"chalk";import Or from"cardinal";import _r from"boxen";var Dr=e=>{var o;let t=/^(?:\/\/\s?title:\s?)(.*?)\n/g,[r,n]=(o=t.exec(e))!=null?o:[];if(n){let s=n.trim(),m=e.replace(r,"");return{title:s,code:m}}return{code:e}},Ge=e=>{let{title:t,code:r}=Dr(e),n="";try{n=Or.highlight(r,{jsx:!0})}catch{n=r}return _r(n,{padding:1,margin:0,borderStyle:"round",borderColor:"gray",titleAlignment:"left",title:t?vr.bold(t):void 0})};var $r=({label:e,files:t,message:r="**`Warning:`** You should use the component where you want to use it."})=>{let n=t.filter(([,p])=>Object.values(P).filter(l=>l!==P.SUCCESS).includes(p)),o="success";switch(n.length){case 0:o="success";break;case t.length:o="error";break;default:o="warning";break}let s=()=>{switch(o){case"success":return g.createElement(T,{color:"blueBright"},"Successfully swizzled ",g.createElement(T,{bold:!0},e));case"warning":return g.createElement(T,{color:"yellowBright"},"Swizzle completed with errors for"," ",g.createElement(T,{bold:!0},e));case"error":return g.createElement(T,{color:"redBright"},"Swizzle failed for ",g.createElement(T,{bold:!0},e))}return null},m=p=>{let l=p==null?void 0:p.replace(process.cwd(),"");return l!=null&&l.startsWith("/")?l.slice(1):l!=null&&l.startsWith("./")?l.slice(2):l},f=()=>g.createElement(g.Fragment,null,g.createElement(T,{dimColor:!0},"File",t.length>1?"s":""," created:"),t.map(([p,l],I)=>l===P.SUCCESS?g.createElement(T,{key:I,dimColor:!0,color:"cyanBright"},` - ${m(p)}`):l===P.TARGET_ALREADY_EXISTS?g.createElement(T,{key:I,dimColor:!0,color:"cyanBright"}," - ",g.createElement(T,{color:"yellowBright",bold:!0},"[FILE_ALREADY_EXISTS]"," "),`${m(p)}`):l===P.SOURCE_PATH_NOT_A_FILE?g.createElement(T,{key:I,dimColor:!0,color:"cyanBright"}," - ",g.createElement(T,{color:"yellowBright",bold:!0},"[SOURCE NOT FOUND]"," "),`${m(p)}`):g.createElement(T,{key:I,dimColor:!0,color:"cyanBright"}," - ",g.createElement(T,{color:"yellowBright",bold:!0},"[",l,"]")))),h=()=>r&&o!=="error"?g.createElement(g.Fragment,null,g.createElement(Ar,{code:Ge},jr(`
`+r)),g.createElement(T,null,"\xA0")):null;return g.createElement(Rr,{width:"100%",flexDirection:"column",alignItems:"flex-start",justifyContent:"flex-start"},g.createElement(T,null,"\xA0"),s(),f(),g.createElement(T,null,"\xA0"),h())},Ze=$r;var Qe=e=>{let t=/(\/\/|\/\*)(\s?)swizzle-remove-start([\s\S]*?)(\/\/|\/\*)(\s?)swizzle-remove-end(\s*)(\*\/)?/g;return e.replace(t,"")};import Mr from"boxen";var et=()=>{let e;try{e=C()}catch{e=void 0}return Ae(e)};var Wr=e=>e.command("swizzle").description(`Export a component or a function from ${z.bold("refine")} packages to customize it in your project`).action(Hr),ot=e=>(t,r="")=>e.filter(o=>{var s;return o.label.toLowerCase().includes(r.toLowerCase())||((s=o.group)==null?void 0:s.toLowerCase().includes(r.toLowerCase()))}).flatMap((o,s,m)=>{var p;return[...(o==null?void 0:o.group)&&((p=m[s-1])==null?void 0:p.group)!==o.group&&o.group?[new te.Separator(`${z.bold(o.group)}`)]:[],{name:` ${o.label}`,value:o!=null&&o.value?o.value:o}]}),Hr=async e=>{var l,I,A,b;te.registerPrompt("autocomplete",Fr);let t=await ye(),r=[];if(await Promise.all(t.map(async i=>{await Te(i.path)&&r.push(i)})),r.length===0){console.log("No refine packages found with swizzle configuration.");return}console.log(`${Mr(`Found ${z.blueBright(r.length)} installed ${z.blueBright.bold("refine")} packages with swizzle configuration.`,{padding:1,textAlignment:"center",dimBorder:!0,borderColor:"blueBright",borderStyle:"round"})}
`);let n=await Promise.all(r.map(async i=>{var u;let d=(u=await Ye(i.path))!=null?u:{swizzle:{items:[]}};return{...i,config:d}})),{selectedPackage:o}=await te.prompt([{type:"autocomplete",pageSize:10,name:"selectedPackage",message:"Which package do you want to swizzle?",emptyText:"No packages found.",source:ot(n.sort((i,d)=>{var u,y,x,w;return((y=(u=i.config)==null?void 0:u.group)!=null?y:"").localeCompare((w=(x=d.config)==null?void 0:x.group)!=null?w:"")}).map(i=>{var d,u,y;return{label:(u=(d=i.config)==null?void 0:d.name)!=null?u:i.name,value:i,group:(y=i.config)==null?void 0:y.group}}))}]),{swizzle:{items:s,transform:m}}=o.config,f;if(s.length===0){console.log(`No swizzle items found for ${z.bold((I=(l=o.config)==null?void 0:l.name)!=null?I:o.name)}`);return}else s.length===1?f=s[0]:s.length>1&&(f=(await te.prompt([{type:"list",pageSize:10,name:"selectedComponent",message:"Which component do you want to swizzle?",emptyText:"No components found.",choices:ot(s.sort((d,u)=>d.group.localeCompare(u.group)))({},"")}])).selectedComponent);if(!f){console.log(`No swizzle items selected for ${z.bold((b=(A=o.config)==null?void 0:A.name)!=null?b:o.name)}`);return}let h=et(),p=await Promise.all(f.files.map(async i=>{var d,u,y;try{let x=i.src?tt.join(o.path,i.src):void 0,w=i.dest?tt.join(process.cwd(),h,i.dest):void 0;if(!x)return console.log("No src path found for file",i),["",P.SOURCE_PATH_NOT_FOUND];if(!w)return console.log("No destination path found for file",i),["",P.TARGET_PATH_NOT_FOUND];if(!await rt(x))return[w,P.SOURCE_PATH_NOT_A_FILE];let fe=await Vr(x,"utf-8");if(await rt(w))return[w,P.TARGET_ALREADY_EXISTS];await Br(w);let G=Qe(fe),ge=(u=(d=i.transform)==null?void 0:d.call(i,G))!=null?u:G,gt=(y=m==null?void 0:m(ge,x,w))!=null?y:ge,ht=We(gt),xt=await Ke(ht);return await Lr(w,xt),[w,P.SUCCESS]}catch{return["",P.UNKNOWN_ERROR]}}));p.length>0&&zr(Ur.createElement(Ze,{label:f.label,files:p,message:f.message}))},nt=Wr;var K=`${process.cwd()}/node_modules/.bin`,S={["react-scripts"]:{dev:["start"],start:["start"],build:["build"],getBin:()=>`${K}/react-scripts`},["vite"]:{dev:["start"],start:["preview"],build:["build"],getBin:()=>`${K}/vite`},["nextjs"]:{dev:["dev"],start:["start"],build:["build"],getBin:()=>`${K}/next`},["remix"]:{dev:["dev"],start:["build"],build:["build"],getBin:e=>`${K}/${e==="start"?"remix-serve":"remix"}`},["craco"]:{dev:["start"],start:["start"],build:["build"],getBin:()=>`${K}/craco`}};import Jr from"execa";var v=async(e,t)=>{var n,o;let r=Jr(e,t,{stdio:"pipe",windowsHide:!1,env:{FORCE_COLOR:"true",...process.env}});return(n=r.stdout)==null||n.pipe(process.stdout),(o=r.stderr)==null||o.pipe(process.stderr),await r};import Yr from"conf";import Kr from"chalk";import*as st from"dotenv";st.config();var qr={development:/dev/i,production:/prod/i,test:/test|tst/i,"continuous-integration":/ci/i,"user-acceptance-testing":/uat/i,"system-integration-testing":/sit/i},Xr=()=>{let e=process.env.NODE_ENV;if(!e)return"development";let t="custom";for(let[r,n]of Object.entries(qr))if(n.test(e)){t=r;break}return t},F={NODE_ENV:Xr(),REFINE_NO_TELEMETRY:process.env.REFINE_NO_TELEMETRY||"false",UPDATE_NOTIFIER_IS_DISABLED:process.env.UPDATE_NOTIFIER_IS_DISABLED||"false",UPDATE_NOTIFIER_CACHE_TTL:process.env.UPDATE_NOTIFIER_CACHE_TTL||1e3*60*60*24};var it=e=>typeof btoa<"u"?btoa(e):Buffer.from(e).toString("base64");var Gr="refine-update-notifier",O=new Yr({projectName:Gr,defaults:{key:"",lastUpdated:0,packages:[]}}),B=async()=>{if(ro())return;let e=await Qr();if(e!==null){if(e){at();return}Zr(),at()}},Zr=async()=>{let e=O.get("packages");!(e!=null&&e.length)||(await Q(e),console.log(`
`))},Qr=async()=>{let e=await to(),t=eo();return e===null?null:!!(t||!e)},at=async()=>{try{let e=await q();return O.set("packages",e),O.set("lastUpdated",Date.now()),O.set("key",await ct()),e}catch{return O.set("packages",[]),O.set("lastUpdated",Date.now()),O.set("key",""),null}},eo=()=>{let e=O.get("lastUpdated");if(!e)return!0;let r=Date.now()-e,n=Number(F.UPDATE_NOTIFIER_CACHE_TTL);return r>=n},to=async()=>{let e=O.get("key"),t=await ct();return t===null?null:e===t},ct=async()=>{let e=await R();if(!e)return console.error(Kr.red("Something went wrong when trying to get installed `refine` packages.")),null;let t=e.map(n=>`${n.name}@${n.version}`);return it(t.toString())},ro=()=>F.UPDATE_NOTIFIER_IS_DISABLED.toLocaleLowerCase()==="true";var V=e=>{let t=C(),r=S[t][e];return t==="remix"&&e==="start"&&(t="remix-serve"),`It runs: \`${t} ${r.join(" ")}\`. Also accepts all the arguments \`${t}\` accepts.`};var oo=e=>e.command("start").description(V("start")).allowUnknownOption(!0).argument("[args...]").action(no),no=async e=>{let t=C(),r=S[t].getBin("start"),o=[...S[t].start,...e];await B(),v(r,o)},me=oo;var so=e=>e.command("dev").description(V("dev")).allowUnknownOption(!0).argument("[args...]").action(io),io=async e=>{let t=C(),r=S[t].getBin("dev"),o=[...S[t].dev,...e];await B(),v(r,o)},le=so;var ao=e=>e.command("build").description(V("build")).allowUnknownOption(!0).argument("[args...]").action(co),co=async e=>{let t=C(),r=S[t].getBin("build"),o=[...S[t].build,...e];await B();try{await v(r,o)}catch{process.exit(1)}},de=ao;import pt from"chalk";var po=e=>e.command("run").description("Runs a defined package script. If no `command` is provided, it will list the available scripts").allowUnknownOption(!0).argument("[command] [args...]").action(mo),mo=async e=>{let[t,...r]=e,n=Z();if(!t){console.log(`Available via ${pt.blue("`refine run`")}:
`);for(let[m,f]of Object.entries(n))console.log(`  ${m}`),console.log(`    ${pt.dim(f)}`),console.log();return}if(!Object.keys(n).includes(t)){let m=`${process.cwd()}/node_modules/.bin/${t}`;v(m,r);return}let s=await D();v(s.name,["run",t,...r])},ue=po;import lo from"envinfo";import uo from"os";var fo=()=>{let e=uo.type();return{Darwin:"macOS",Linux:"Linux",Windows_NT:"Windows"}[e]},mt=async()=>{let[e,t]=await lo.helpers.getOSInfo();return{name:fo(),version:t}};import go from"node-fetch";var ho=async()=>{let e=await mt();return{nodeEnv:F.NODE_ENV,nodeVersion:process.version,os:e.name,osVersion:e.version,command:process.argv[2],packages:await R()||[],projectFramework:C()}},lt=async()=>{if(F.REFINE_NO_TELEMETRY!=="true")try{let e=await ho();await go("https://telemetry.refine.dev/cli",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})}catch{}};import yo from"react";import _ from"react";import{Box as xo,Text as L,Newline as dt}from"ink";var wo=()=>_.createElement(xo,{flexDirection:"column",alignItems:"flex-start",justifyContent:"flex-start",borderColor:"greenBright",borderStyle:"double",padding:1},_.createElement(L,{color:"cyanBright"},"refine v4 is released \u{1F389} You can upgrade to v4 with a single command without hassle!"),_.createElement(dt,null),_.createElement(L,{color:"greenBright"},"\u2705 %100 Backwards compatible"),_.createElement(L,{color:"greenBright"},"\u2705 Bring your own router"),_.createElement(L,{color:"greenBright"},"\u2705 Reduced bundle size"),_.createElement(L,{color:"greenBright"},"\u2705 More consistent API"),_.createElement(dt,null),_.createElement(L,null,"See the migration guide here: https://refine.dev/docs/migration-guide/3x-to-4x")),ut=wo;import{render as To}from"ink";var Co=()=>To(yo.createElement(ut,null)),ft=Co;var Io=()=>{let e;try{e=W()}catch{console.error("The `package.json` file required to run could not be found."),process.exit(1)}let t=new Eo;t.version(e.version,"-v, --version","Output the current version.").description(Po.textSync("refine",{font:"Isometric1",horizontalLayout:"full",verticalLayout:"full",whitespaceBreak:!0})).usage("<command> [options]").helpOption("-h, --help","Output usage information."),nt(t),$e(t),Ve(t),le(t),de(t),me(t),ue(t),Ne(t),Ue(t),t.hook("postAction",r=>{let n=r.args[0];ft(),!["run"].includes(n)&&lt()}),t.parse(process.argv),process.argv.slice(2).length||t.outputHelp()};Io();
//# sourceMappingURL=cli.js.map