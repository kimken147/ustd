#!/usr/bin/env node
(()=>{var er=Object.create;var pe=Object.defineProperty;var tr=Object.getOwnPropertyDescriptor;var rr=Object.getOwnPropertyNames;var or=Object.getPrototypeOf,nr=Object.prototype.hasOwnProperty;var a=(e=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(e,{get:(t,r)=>(typeof require!="undefined"?require:t)[r]}):e)(function(e){if(typeof require!="undefined")return require.apply(this,arguments);throw new Error('Dynamic require of "'+e+'" is not supported')});var sr=(e,t)=>{for(var r in t)pe(e,r,{get:t[r],enumerable:!0})},ar=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of rr(t))!nr.call(e,o)&&o!==r&&pe(e,o,{get:()=>t[o],enumerable:!(n=tr(t,o))||n.enumerable});return e};var p=(e,t,r)=>(r=e!=null?er(or(e)):{},ar(t||!e||!e.__esModule?pe(r,"default",{value:e,enumerable:!0}):r,e));var Yt=a("commander"),Kt=p(a("figlet"));var ze=p(a("react")),Ve=a("ink");var j=a("fs-extra"),ve=p(a("globby")),me=p(a("execa")),Ne=p(a("preferred-pm"));var be=p(a("ora")),ir=async(e,t)=>{let r=(0,be.default)({color:"cyan",text:t}).start(),n=await e();return r.stop(),n},V=ir;var X=()=>{if(!(0,j.existsSync)("package.json"))throw new Error("./package.json not found");return JSON.parse((0,j.readFileSync)("package.json","utf8"))},Y=()=>{let e=X();return Object.keys(e.dependencies||{})};var Oe=()=>{let e=X();return Object.keys(e.devDependencies||{})},re=()=>X().scripts,L=async()=>{var e;try{let t=await(0,me.default)("npm",["ls","--depth=0","--json"],{reject:!1}),r=((e=JSON.parse(t.stdout))==null?void 0:e.dependencies)||{},n=Object.keys(r).filter(s=>s.startsWith("@pankod/refine")),o=[];for(let s of n){let m=r[s].version;o.push({name:s,version:m})}return o}catch{return Promise.resolve(null)}},_e=async()=>{try{let e=await(0,ve.default)("node_modules/@pankod/refine-*",{onlyDirectories:!0}),t=[];return await Promise.all(e.map(async r=>{if(await(0,j.pathExists)(`${r}/package.json`)){let o=await(0,j.readJSON)(`${r}/package.json`);t.push({name:o.name,path:r})}})),t}catch{return[]}},De=async e=>await(0,j.pathExists)(`${e}/refine.config.js`),K={npm:{install:["install","--save"],installDev:["install","--save-dev"],outdatedJson:["outdated","--json"]},yarn:{install:["add"],installDev:["add","-D"],outdatedJson:["outdated","--json"]},pnpm:{install:["add"],installDev:["add","-D"],outdatedJson:["outdated","--format","json"]}},U=async()=>{let e=await V(()=>(0,Ne.default)(process.cwd()),"Getting package manager...");if(!e)throw new Error("Package manager not found.");return e},je=async e=>{let t=await U();try{let r=K[t.name].install,n=(0,me.default)(t.name,[...r,...e],{stdio:"inherit"});n.on("message",o=>{console.log(o)}),n.on("error",o=>{console.log(o)}),n.on("exit",o=>{if(o===0){console.log("All `refine` packages updated  \u{1F389}");return}console.log(`Application exited with code ${o}`)})}catch(r){throw new Error(r)}},Ae=e=>{let t=e.lastIndexOf("@");return t<=0?{name:e,version:null}:{name:e.slice(0,t),version:e.slice(t+1)}};var T=p(a("react")),Fe=p(a("ink-table")),P=a("ink"),Re={name:1,current:2,wanted:3,latest:4},cr=4,le=e=>{let t=e.split(".");return{major:t[0],minor:t[1],patch:t[2]}},$e=(e,t)=>e.major.trim()!==t.major.trim()?{major:"red",minor:"red",patch:"red"}:e.minor.trim()!==t.minor.trim()?{major:"white",minor:"yellow",patch:"yellow"}:e.patch.trim()!==t.patch.trim()?{major:"white",minor:"white",patch:"green"}:{major:"white",minor:"white",patch:"white"},pr=({data:e,command:t})=>{let r=(0,T.useRef)(1),n=(0,T.useRef)(0);return T.default.createElement(P.Box,{width:"100%",flexDirection:"column",alignItems:"center",justifyContent:"center"},T.default.createElement(P.Text,null,"Update Available"),T.default.createElement(Fe.default,{data:e,cell:o=>{var h;let s=T.default.createElement(P.Text,null,o.children),m=(h=o.children)==null?void 0:h.toString();if(!m)return s;let f=le(e[n.current].current);if(r.current===Re.wanted){let c=le(m),l=$e(f,c);s=T.default.createElement(Ue,{major:{color:l.major,text:c.major},minor:{color:l.minor,text:c.minor},patch:{color:l.patch,text:c.patch}})}if(r.current===Re.latest){let c=le(m),l=$e(f,c);s=T.default.createElement(Ue,{major:{color:l.major,text:c.major},minor:{color:l.minor,text:c.minor},patch:{color:l.patch,text:c.patch}})}return r.current===cr?(n.current+=1,r.current=1):r.current+=1,s}}),T.default.createElement(P.Text,null,"To update ",T.default.createElement(P.Text,{bold:!0},"`refine`")," packages with the wanted version"),T.default.createElement(P.Text,null,"Run the following command"," ",T.default.createElement(P.Text,{color:"yellowBright"},t)))},Ue=({major:e,minor:t,patch:r})=>T.default.createElement(P.Text,null,T.default.createElement(P.Text,{color:e.color},e.text),T.default.createElement(P.Text,{color:t.color},".",t.text,"."),T.default.createElement(P.Text,{color:r.color},r.text)),Be=pr;var mr=async()=>{let e="npx @pankod/refine-cli update",t=Y(),r=Object.keys(re()),n=t.includes("@pankod/refine-cli"),o=r.includes("refine");if(!n&&!o)return e;let s=await U();return o?`${s.name} run refine update`:n?"npx refine update":e},oe=async e=>{let t=await mr();(0,Ve.render)(ze.default.createElement(Be,{data:e,command:t}))};var Le=p(a("execa"));var Me=p(a("semver-diff")),lr=e=>e.command("check-updates").description("Check all installed `refine` packages are up to date").action(dr),dr=async()=>{let e=await V(G,"Checking for updates...");if(!e.length){console.log("All `refine` packages are up to date \u{1F389}\n");return}await oe(e)},G=async()=>await ur(),ur=async()=>{let e=await fr();if(!e)return[];let t=[];return Object.keys(e).forEach(n=>{let o=e[n];n.includes("@pankod/refine")&&t.push({name:n,current:o.current,wanted:o.wanted,latest:o.latest})}),t.filter(n=>!!(0,Me.default)(n.current,n.latest))},fr=async()=>{let e="npm",{stdout:t,timedOut:r}=await(0,Le.default)(e,K[e].outdatedJson,{reject:!1,timeout:25e3});if(r)throw new Error("Timed out while checking for updates.");return t?JSON.parse(t):null},We=lr;var v=a("fs-extra"),ne=p(a("temp")),Ke=a("pluralize"),Ge=p(a("execa")),Ze=p(a("inquirer")),ge=a("path");var Z=(s=>(s.REACT_SCRIPT="react-scripts",s.REMIX="remix",s.NEXTJS="nextjs",s.VITE="vite",s.CRACO="craco",s))(Z||{});var de=(o=>(o.ANTD="antd",o.MUI="mui",o.MANTINE="mantine",o.CHAKRA="chakra-ui",o))(de||{});var He=(n=>(n.NPM="npm",n.YARN="yarn",n.PNPM="pnpm",n))(He||{});var E=()=>{let e=Y();if(e.includes("@craco/craco"))return"craco";if(e.includes("react-scripts"))return"react-scripts";if(e.includes("next"))return"nextjs";if(e.includes("@remix-run/react"))return"remix";if(Oe().includes("vite"))return"vite";throw new Error("Project type not found")},Je=()=>{let e=Y();if(e.includes("@pankod/refine-antd"))return"antd";if(e.includes("@pankod/refine-mui"))return"mui";if(e.includes("@pankod/refine-chakra-ui"))return"chakra-ui";if(e.includes("@pankod/refine-mantine"))return"mantine"};var F=p(a("handlebars")),_=a("fs-extra"),gr=(e,t)=>{let r=(0,_.readFileSync)(e);return F.default.registerHelper("ifIn",function(o,s,m){return o.includes(s)?m.fn(F.default):m.inverse(F.default)}),F.default.registerHelper("formatInferencerComponent",function(o){if(!!o)switch(o){case"chakra-ui":return"ChakraUI";default:return o.charAt(0).toUpperCase()+o.slice(1)}}),F.default.registerHelper("capitalize",function(o){if(!!o)return o.charAt(0).toUpperCase()+o.slice(1)}),F.default.compile(r.toString())(t)},qe=(e,t)=>{(0,_.readdirSync)(e).forEach(n=>{let o=`${e}/${n}`,s=`${e}/${n.replace(".hbs","")}`;(0,_.createFileSync)(s),(0,_.writeFileSync)(s,gr(o,t)),(0,_.unlinkSync)(o)})};var Xe=e=>e.charAt(0).toUpperCase()+e.slice(1);var ue=e=>{switch(e){case"nextjs":return{path:"src/components",alias:"../src/components"};case"remix":return{path:"app/components",alias:"~/components"}}return{path:"src/pages",alias:"pages"}},Ye=e=>{switch(e){case"remix":return"./app";case"nextjs":case"react-scripts":case"vite":case"craco":default:return"./src"}};var fe=["list","create","edit","show"],hr=e=>{let t=E(),{path:r}=ue(t);return e.command("create-resource").allowExcessArguments(!0).description("Create a new resource files").option("-a, --actions [actions]","Only generate the specified actions. (ex: list,create,edit,show)","list,create,edit,show").option("-p, --path [path]","Path to generate the resource files",r).action(xr)},xr=async(e,t)=>{let{args:r}=t,n=e.actions;if(!r.length){let{name:o,selectedActions:s}=await Ze.default.prompt([{type:"input",name:"name",message:"Resource Name",validate:m=>m?!0:"Resource Name is required"},{type:"checkbox",name:"selectedActions",message:"Select Actions",choices:fe,default:e.actions.split(",")}]);r=[o],n=s.join(",")}r.forEach(o=>{let s=n?n.split(","):void 0,{path:m,alias:f}=ue(E()),h=(0,Ke.plural)(o).toLowerCase(),c=(0,ge.join)(process.cwd(),m,h);if((0,v.pathExistsSync)(c)){console.error(`Resource (${(0,ge.join)(m,h)}) already exist! \u274C`);return}let l=Xe(o),S=Je(),z=`${__dirname}/../templates/resource`,O=wr();(0,v.copySync)(z,O);let i={resourceName:o,resource:l,actions:s||fe,uiFramework:S};qe(O,i),s&&fe.forEach(b=>{s.includes(b)||(0,v.unlinkSync)(`${O}/${b}.tsx`)}),(0,v.mkdirSync)(e.path,{recursive:!0});let d=`${e.path}/${h}`,u={};(0,v.pathExistsSync)(d)&&(u={overwrite:!0}),(0,v.moveSync)(O,d,u),ne.default.cleanupSync();let C=a.resolve(".bin/jscodeshift"),{stderr:x,stdout:y}=Ge.default.sync(C,["./","--extensions=ts,tsx,js,jsx","--parser=tsx",`--transform=${__dirname}/../src/transformers/resource.ts`,"--ignore-pattern=**/.cache/**","--ignore-pattern=**/node_modules/**","--ignore-pattern=**/build/**","--ignore-pattern=**/.next/**",`--__actions=${i.actions}`,`--__pathAlias=${f}`,`--__resourceFolderName=${h}`,`--__resource=${l}`,`--__resourceName=${o}`]);x&&console.log(x),console.log(`Resource (${d}) generated successfully! \u{1F389}`)})},wr=()=>(ne.default.track(),ne.default.mkdirSync("resource")),Qe=hr;var et=p(a("envinfo")),tt=p(a("ora")),yr=e=>e.command("whoami").description("View the details of the development environment").action(Tr),Tr=async()=>{let e=(0,tt.default)("Loading environment details...").start(),t=await et.default.run({System:["OS","CPU"],Binaries:["Node","Yarn","npm"],Browsers:["Chrome","Firefox","Safari"]},{showNotFound:!0,markdown:!0}),n=(await L()||[]).map(o=>` - ${o.name}: ${o.version}`).join(`
`);e.stop(),console.log(t),console.log("## Refine Packages:"),console.log(n)},rt=yr;var st=a("commander");var M=p(a("inquirer")),he=p(a("semver-diff")),se=p(a("chalk"));var ot=e=>{let t=e.filter((n,o)=>e.indexOf(n)!==o),r=new Set(t);return Array.from(r)};var nt=async e=>{let t=Er(e);if(!t){console.log("All `refine` packages are up to date. \u{1F389}");return}let r=Pr(t),n=await M.default.prompt([{type:"checkbox",name:"packages",message:"Choose packages to update",pageSize:r.pageSize,choices:r.choices,validate:Cr}]);return n.packages.length>0?n.packages:null},Cr=e=>{let r=e.map(o=>Ae(o)).map(o=>o.name),n=ot(r);return n.length>0?`You can't update the same package more than once. Please choice one.
 Duplicates: ${n.join(", ")}`:!0},Er=e=>{if(e.length===0)return null;let t={patch:[],minor:[],major:[]};return e.forEach(r=>{let n=r.current,o=(0,he.default)(n,r.wanted),s=(0,he.default)(n,r.latest);if(o===s&&s){t[s].push({name:r.name,from:n,to:r.latest});return}o&&t[o].push({name:r.name,from:n,to:r.wanted}),s&&t[s].push({name:r.name,from:n,to:r.latest})}),t},Pr=e=>{let t=0,r=0;[e.patch,e.minor,e.major].forEach(c=>{c.forEach(l=>{l.name.length>t&&(t=l.name.length),l.from.length>r&&(r=l.from.length)})}),t+=2;let n=[],o="Package".padEnd(t),s="From".padEnd(r),f=`
   ${o} ${s}${"To".padStart(r)}`;n.push(new M.default.Separator(f)),e.patch.length>0&&(n.push(new M.default.Separator(se.default.reset.bold.blue(`
Patch Updates`))),e.patch.forEach(c=>{n.push({name:`${c.name.padEnd(t)} ${c.from.padStart(r)} -> ${c.to}`,value:`${c.name}@${c.to}`})})),e.minor.length>0&&(n.push(new M.default.Separator(se.default.reset.bold.blue(`
Minor Updates`))),e.minor.forEach(c=>{n.push({name:`${c.name.padEnd(t)} ${c.from.padStart(r)} -> ${c.to}`,value:`${c.name}@${c.to}`})})),e.major.length>0&&(n.push(new M.default.Separator(se.default.reset.bold.blue(`
Major Updates`))),e.major.forEach(c=>{n.push({name:`${c.name.padEnd(t)} ${c.from.padStart(r)} -> ${c.to}`,value:`${c.name}@${c.to}`})}));let h=n.length+6;return{choices:n,pageSize:h}};var Ir=e=>e.command("update").description("Interactively select and update all `refine` packages to selected version. To skip the interactive mode, use the `--all` option.").addOption(new st.Option("-t, --tag [tag]","Select version to update to.").choices(["next","latest"]).default("wanted","Version ranges in the `package.json` will be installed")).option("-a, --all","Update all `refine` packages to the selected `tag`. If `tag` is not provided, version ranges in the `package.json` will be installed. This option skips the interactive mode.",!1).option("-d, --dry-run","Get outdated packages installation command without automatic updating. If `tag` is not provided, version ranges in the `package.json` will be used.",!1).action(kr),kr=async e=>{let{tag:t,dryRun:r,all:n}=e,o=await V(G,"Checking for updates...");if(!(o!=null&&o.length)){console.log("All `refine` packages are up to date \u{1F389}");return}let s=n?Sr(t,o):await nt(o);if(!!s){if(r){br(s);return}vr(s)}},Sr=(e,t)=>e==="wanted"&&t.every(o=>o.current===o.wanted)?(console.log("All `refine` packages are up to date with the wanted version \u{1F389}"),null):t.map(n=>{let o=e==="wanted"?n.wanted:e;return`${n.name}@${o}`}),br=async e=>{let t=await U(),r=K[t.name].install;console.log(`${t.name} ${r.join(" ")} ${e.join(" ")}`)},vr=e=>{console.log("Updating `refine` packages..."),console.log(e),je(e)},at=Ir;var vt=p(a("react")),Nt=a("ink"),ye=p(a("path")),B=p(a("chalk")),Q=p(a("inquirer")),Ot=p(a("inquirer-autocomplete-prompt")),A=a("fs-extra");var we=p(a("path"));var ut=p(a("path"));var xe={};sr(xe,{PackageManagerTypes:()=>He,ProjectTypes:()=>Z,UIFrameworks:()=>de,appendAfterImports:()=>mt,getFileContent:()=>ae,getImports:()=>W,getNameChangeInImport:()=>ct});var Nr=/import(?:(?:(?:[ \n\t]+([^ *\n\t\{\},]+)[ \n\t]*(?:,|[ \n\t]+))?([ \n\t]*\{(?:[ \n\t]*[^ \n\t"'\{\}]+[ \n\t]*,?)+\})?[ \n\t]*)|[ \n\t]*\*[ \n\t]*as[ \n\t]+([^ \n\t\{\}]+)[ \n\t]+)from[ \n\t]*(?:['"])([^'"\n]+)(?:['"])(?:;?)/g,Or=/((?:\w|\s|_)*)( as )((?:\w|\s|_)*)( |,)?/g,W=e=>{let t=e.matchAll(Nr),r=[];for(let n of t){let[o,s,m,f,h]=n;r.push({statement:o,importPath:h,...s&&{defaultImport:s},...m&&{namedImports:m},...f&&{namespaceImport:f}})}return r==null?void 0:r.filter(Boolean)},ct=e=>{let t=e.matchAll(Or),r=[];for(let n of t){let[o,s,m,f,h]=n;r.push({statement:o,fromName:s.trim(),toName:f.trim(),afterCharacter:h})}return r},_r=(e,t)=>{var s;let r=e.substring(0,e.indexOf(t.statement)),n=W(r).pop();return n?r.substring(r.indexOf(n==null?void 0:n.statement)+((s=n==null?void 0:n.statement)==null?void 0:s.length)):r},Dr=(e,t)=>!!(t?_r(e,t):"").trim(),it=["react","@pankod/refine-core","@pankod/refine-"],pt=e=>{var O;let t=e,r=W(e),n=r.filter(i=>!i.statement.includes("import type ")),o=r.filter(i=>i.statement.includes("import type")),s=[],m=[];n.forEach(i=>{Dr(e,i)?s.push(i):m.push(i)});let f=t.indexOf((O=m==null?void 0:m[0])==null?void 0:O.statement);m.forEach(i=>{t=t.replace(i.statement,"")}),o.forEach(i=>{t=t.replace(i.statement,"")});let h=m.reduce((i,d)=>{let{importPath:u}=d;return i[u]?i[u].push(d):i[u]=[d],i},{}),S=[...Object.entries(h).map(([i,d])=>{let u=d.find(b=>b.defaultImport),C=d.find(b=>b.namespaceImport),x=d.filter(b=>b.namedImports).map(b=>{var ce;return((ce=b.namedImports)!=null?ce:"").replace(/{|}/g,"").trim().split(",").map(te=>te.trim()).filter(Boolean).join(", ")}).join(", "),y="";return C&&(y+=C.statement+`
`),(u||x)&&(u&&x?y+=`import ${u.defaultImport}, { ${x} } from "${d[0].importPath}";
`:u?y+=`import ${u.defaultImport} from "${d[0].importPath}";
`:y+=`import { ${x} } from "${d[0].importPath}";
`),[i,y]})].sort(([i],[d])=>{let u=it.findIndex(x=>i.includes(x)),C=it.findIndex(x=>d.includes(x));return u===C?i.localeCompare(d):u===-1?1:C===-1?-1:u-C}).map(([,i])=>i).join(""),z=o.map(i=>i.statement).join(`
`);return t=t.substring(0,f)+S+z+t.substring(f),t};var mt=(e,t)=>{let r=W(e),n=r[r.length-1],o=n?e.indexOf(n.statement):e.length-1;return e.slice(0,o+(n==null?void 0:n.statement.length))+`
`+t+`
`+e.slice(o+(n==null?void 0:n.statement.length))};var lt=a("fs-extra"),dt=a("path");function ae(e){if(!!(this!=null&&this.absolutePackageDir))try{return(0,lt.readFileSync)((0,dt.join)(this.absolutePackageDir,e)).toString()}catch{return}}var ft=a("module"),jr=ft.prototype.require,gt=(e,t)=>{ft.prototype.require=function(...r){return r[0]==="@pankod/refine-cli"?{...xe,getFileContent:n=>ae.call({absolutePackageDir:t?e:ut.default.join(process.cwd(),e)},n)}:jr.apply(this,r)}};var ht=async(e,t)=>{try{return gt(e,t),a(we.default.join(t?e:we.default.join(process.cwd(),e),"refine.config.js"))}catch{return}};var ie=a("prettier"),xt=async e=>{try{let t=await(0,ie.resolveConfig)(process.cwd());return(0,ie.format)(e,{...t!=null?t:{},parser:"typescript"})}catch{return e}};var g=p(a("react")),Et=p(a("ink-markdown")),Pt=p(a("dedent")),w=a("ink");var I={SUCCESS:"SUCCESS",UNKNOWN_ERROR:"UNKNOWN_ERROR",SOURCE_PATH_NOT_FOUND:"SOURCE_PATH_NOT_FOUND",TARGET_PATH_NOT_FOUND:"TARGET_PATH_NOT_FOUND",SOURCE_PATH_NOT_A_FILE:"SOURCE_PATH_NOT_A_FILE",TARGET_ALREADY_EXISTS:"TARGET_ALREADY_EXISTS"};var wt=p(a("chalk")),yt=p(a("cardinal")),Tt=p(a("boxen")),Ar=e=>{var o;let t=/^(?:\/\/\s?title:\s?)(.*?)\n/g,[r,n]=(o=t.exec(e))!=null?o:[];if(n){let s=n.trim(),m=e.replace(r,"");return{title:s,code:m}}return{code:e}},Ct=e=>{let{title:t,code:r}=Ar(e),n="";try{n=yt.default.highlight(r,{jsx:!0})}catch{n=r}return(0,Tt.default)(n,{padding:1,margin:0,borderStyle:"round",borderColor:"gray",titleAlignment:"left",title:t?wt.default.bold(t):void 0})};var Rr=({label:e,files:t,message:r="**`Warning:`** You should use the component where you want to use it."})=>{let n=t.filter(([,c])=>Object.values(I).filter(l=>l!==I.SUCCESS).includes(c)),o="success";switch(n.length){case 0:o="success";break;case t.length:o="error";break;default:o="warning";break}let s=()=>{switch(o){case"success":return g.default.createElement(w.Text,{color:"blueBright"},"Successfully swizzled ",g.default.createElement(w.Text,{bold:!0},e));case"warning":return g.default.createElement(w.Text,{color:"yellowBright"},"Swizzle completed with errors for"," ",g.default.createElement(w.Text,{bold:!0},e));case"error":return g.default.createElement(w.Text,{color:"redBright"},"Swizzle failed for ",g.default.createElement(w.Text,{bold:!0},e))}return null},m=c=>{let l=c==null?void 0:c.replace(process.cwd(),"");return l!=null&&l.startsWith("/")?l.slice(1):l!=null&&l.startsWith("./")?l.slice(2):l},f=()=>g.default.createElement(g.default.Fragment,null,g.default.createElement(w.Text,{dimColor:!0},"File",t.length>1?"s":""," created:"),t.map(([c,l],S)=>l===I.SUCCESS?g.default.createElement(w.Text,{key:S,dimColor:!0,color:"cyanBright"},` - ${m(c)}`):l===I.TARGET_ALREADY_EXISTS?g.default.createElement(w.Text,{key:S,dimColor:!0,color:"cyanBright"}," - ",g.default.createElement(w.Text,{color:"yellowBright",bold:!0},"[FILE_ALREADY_EXISTS]"," "),`${m(c)}`):l===I.SOURCE_PATH_NOT_A_FILE?g.default.createElement(w.Text,{key:S,dimColor:!0,color:"cyanBright"}," - ",g.default.createElement(w.Text,{color:"yellowBright",bold:!0},"[SOURCE NOT FOUND]"," "),`${m(c)}`):g.default.createElement(w.Text,{key:S,dimColor:!0,color:"cyanBright"}," - ",g.default.createElement(w.Text,{color:"yellowBright",bold:!0},"[",l,"]")))),h=()=>r&&o!=="error"?g.default.createElement(g.default.Fragment,null,g.default.createElement(Et.default,{code:Ct},(0,Pt.default)(`
`+r)),g.default.createElement(w.Text,null,"\xA0")):null;return g.default.createElement(w.Box,{width:"100%",flexDirection:"column",alignItems:"flex-start",justifyContent:"flex-start"},g.default.createElement(w.Text,null,"\xA0"),s(),f(),g.default.createElement(w.Text,null,"\xA0"),h())},It=Rr;var kt=e=>{let t=/(\/\/|\/\*)(\s?)swizzle-remove-start([\s\S]*?)(\/\/|\/\*)(\s?)swizzle-remove-end(\s*)(\*\/)?/g;return e.replace(t,"")};var _t=p(a("boxen"));var St=()=>{let e;try{e=E()}catch{e=void 0}return Ye(e)};var $r=e=>e.command("swizzle").description(`Export a component or a function from ${B.default.bold("refine")} packages to customize it in your project`).action(Ur),bt=e=>(t,r="")=>e.filter(o=>{var s;return o.label.toLowerCase().includes(r.toLowerCase())||((s=o.group)==null?void 0:s.toLowerCase().includes(r.toLowerCase()))}).flatMap((o,s,m)=>{var c;return[...(o==null?void 0:o.group)&&((c=m[s-1])==null?void 0:c.group)!==o.group&&o.group?[new Q.default.Separator(`${B.default.bold(o.group)}`)]:[],{name:` ${o.label}`,value:o!=null&&o.value?o.value:o}]}),Ur=async e=>{var l,S,z,O;Q.default.registerPrompt("autocomplete",Ot.default);let t=await _e(),r=[];if(await Promise.all(t.map(async i=>{await De(i.path)&&r.push(i)})),r.length===0){console.log("No refine packages found with swizzle configuration.");return}console.log(`${(0,_t.default)(`Found ${B.default.blueBright(r.length)} installed ${B.default.blueBright.bold("refine")} packages with swizzle configuration.`,{padding:1,textAlignment:"center",dimBorder:!0,borderColor:"blueBright",borderStyle:"round"})}
`);let n=await Promise.all(r.map(async i=>{var u;let d=(u=await ht(i.path))!=null?u:{swizzle:{items:[]}};return{...i,config:d}})),{selectedPackage:o}=await Q.default.prompt([{type:"autocomplete",pageSize:10,name:"selectedPackage",message:"Which package do you want to swizzle?",emptyText:"No packages found.",source:bt(n.sort((i,d)=>{var u,C,x,y;return((C=(u=i.config)==null?void 0:u.group)!=null?C:"").localeCompare((y=(x=d.config)==null?void 0:x.group)!=null?y:"")}).map(i=>{var d,u,C;return{label:(u=(d=i.config)==null?void 0:d.name)!=null?u:i.name,value:i,group:(C=i.config)==null?void 0:C.group}}))}]),{swizzle:{items:s,transform:m}}=o.config,f;if(s.length===0){console.log(`No swizzle items found for ${B.default.bold((S=(l=o.config)==null?void 0:l.name)!=null?S:o.name)}`);return}else s.length===1?f=s[0]:s.length>1&&(f=(await Q.default.prompt([{type:"list",pageSize:10,name:"selectedComponent",message:"Which component do you want to swizzle?",emptyText:"No components found.",choices:bt(s.sort((d,u)=>d.group.localeCompare(u.group)))({},"")}])).selectedComponent);if(!f){console.log(`No swizzle items selected for ${B.default.bold((O=(z=o.config)==null?void 0:z.name)!=null?O:o.name)}`);return}let h=St(),c=await Promise.all(f.files.map(async i=>{var d,u,C;try{let x=i.src?ye.default.join(o.path,i.src):void 0,y=i.dest?ye.default.join(process.cwd(),h,i.dest):void 0;if(!x)return console.log("No src path found for file",i),["",I.SOURCE_PATH_NOT_FOUND];if(!y)return console.log("No destination path found for file",i),["",I.TARGET_PATH_NOT_FOUND];if(!await(0,A.pathExists)(x))return[y,I.SOURCE_PATH_NOT_A_FILE];let ke=await(0,A.readFile)(x,"utf-8");if(await(0,A.pathExists)(y))return[y,I.TARGET_ALREADY_EXISTS];await(0,A.ensureFile)(y);let te=kt(ke),Se=(u=(d=i.transform)==null?void 0:d.call(i,te))!=null?u:te,Gt=(C=m==null?void 0:m(Se,x,y))!=null?C:Se,Zt=pt(Gt),Qt=await xt(Zt);return await(0,A.writeFile)(y,Qt),[y,I.SUCCESS]}catch{return["",I.UNKNOWN_ERROR]}}));c.length>0&&(0,Nt.render)(vt.default.createElement(It,{label:f.label,files:c,message:f.message}))},Dt=$r;var ee=`${process.cwd()}/node_modules/.bin`,N={["react-scripts"]:{dev:["start"],start:["start"],build:["build"],getBin:()=>`${ee}/react-scripts`},["vite"]:{dev:["start"],start:["preview"],build:["build"],getBin:()=>`${ee}/vite`},["nextjs"]:{dev:["dev"],start:["start"],build:["build"],getBin:()=>`${ee}/next`},["remix"]:{dev:["dev"],start:["build"],build:["build"],getBin:e=>`${ee}/${e==="start"?"remix-serve":"remix"}`},["craco"]:{dev:["start"],start:["start"],build:["build"],getBin:()=>`${ee}/craco`}};var jt=p(a("execa")),R=async(e,t)=>{var n,o;let r=(0,jt.default)(e,t,{stdio:"pipe",windowsHide:!1,env:{FORCE_COLOR:"true",...process.env}});return(n=r.stdout)==null||n.pipe(process.stdout),(o=r.stderr)==null||o.pipe(process.stderr),await r};var Ut=p(a("conf")),Ft=p(a("chalk"));var At=p(a("dotenv"));At.config();var Fr={development:/dev/i,production:/prod/i,test:/test|tst/i,"continuous-integration":/ci/i,"user-acceptance-testing":/uat/i,"system-integration-testing":/sit/i},Br=()=>{let e=process.env.NODE_ENV;if(!e)return"development";let t="custom";for(let[r,n]of Object.entries(Fr))if(n.test(e)){t=r;break}return t},H={NODE_ENV:Br(),REFINE_NO_TELEMETRY:process.env.REFINE_NO_TELEMETRY||"false",UPDATE_NOTIFIER_IS_DISABLED:process.env.UPDATE_NOTIFIER_IS_DISABLED||"false",UPDATE_NOTIFIER_CACHE_TTL:process.env.UPDATE_NOTIFIER_CACHE_TTL||1e3*60*60*24};var Rt=e=>typeof btoa<"u"?btoa(e):Buffer.from(e).toString("base64");var zr="refine-update-notifier",$=new Ut.default({projectName:zr,defaults:{key:"",lastUpdated:0,packages:[]}}),J=async()=>{if(Hr())return;let e=await Lr();if(e!==null){if(e){$t();return}Vr(),$t()}},Vr=async()=>{let e=$.get("packages");!(e!=null&&e.length)||(await oe(e),console.log(`
`))},Lr=async()=>{let e=await Wr(),t=Mr();return e===null?null:!!(t||!e)},$t=async()=>{try{let e=await G();return $.set("packages",e),$.set("lastUpdated",Date.now()),$.set("key",await Bt()),e}catch{return $.set("packages",[]),$.set("lastUpdated",Date.now()),$.set("key",""),null}},Mr=()=>{let e=$.get("lastUpdated");if(!e)return!0;let r=Date.now()-e,n=Number(H.UPDATE_NOTIFIER_CACHE_TTL);return r>=n},Wr=async()=>{let e=$.get("key"),t=await Bt();return t===null?null:e===t},Bt=async()=>{let e=await L();if(!e)return console.error(Ft.default.red("Something went wrong when trying to get installed `refine` packages.")),null;let t=e.map(n=>`${n.name}@${n.version}`);return Rt(t.toString())},Hr=()=>H.UPDATE_NOTIFIER_IS_DISABLED.toLocaleLowerCase()==="true";var q=e=>{let t=E(),r=N[t][e];return t==="remix"&&e==="start"&&(t="remix-serve"),`It runs: \`${t} ${r.join(" ")}\`. Also accepts all the arguments \`${t}\` accepts.`};var Jr=e=>e.command("start").description(q("start")).allowUnknownOption(!0).argument("[args...]").action(qr),qr=async e=>{let t=E(),r=N[t].getBin("start"),o=[...N[t].start,...e];await J(),R(r,o)},Te=Jr;var Xr=e=>e.command("dev").description(q("dev")).allowUnknownOption(!0).argument("[args...]").action(Yr),Yr=async e=>{let t=E(),r=N[t].getBin("dev"),o=[...N[t].dev,...e];await J(),R(r,o)},Ce=Xr;var Kr=e=>e.command("build").description(q("build")).allowUnknownOption(!0).argument("[args...]").action(Gr),Gr=async e=>{let t=E(),r=N[t].getBin("build"),o=[...N[t].build,...e];await J();try{await R(r,o)}catch{process.exit(1)}},Ee=Kr;var Pe=p(a("chalk"));var Zr=e=>e.command("run").description("Runs a defined package script. If no `command` is provided, it will list the available scripts").allowUnknownOption(!0).argument("[command] [args...]").action(Qr),Qr=async e=>{let[t,...r]=e,n=re();if(!t){console.log(`Available via ${Pe.default.blue("`refine run`")}:
`);for(let[m,f]of Object.entries(n))console.log(`  ${m}`),console.log(`    ${Pe.default.dim(f)}`),console.log();return}if(!Object.keys(n).includes(t)){let m=`${process.cwd()}/node_modules/.bin/${t}`;R(m,r);return}let s=await U();R(s.name,["run",t,...r])},Ie=Zr;var zt=p(a("envinfo")),Vt=p(a("os")),eo=()=>{let e=Vt.default.type();return{Darwin:"macOS",Linux:"Linux",Windows_NT:"Windows"}[e]},Lt=async()=>{let[e,t]=await zt.default.helpers.getOSInfo();return{name:eo(),version:t}};var Mt=p(a("node-fetch")),to=async()=>{let e=await Lt();return{nodeEnv:H.NODE_ENV,nodeVersion:process.version,os:e.name,osVersion:e.version,command:process.argv[2],packages:await L()||[],projectFramework:E()}},Wt=async()=>{if(H.REFINE_NO_TELEMETRY!=="true")try{let e=await to();await(0,Mt.default)("https://telemetry.refine.dev/cli",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})}catch{}};var Jt=p(a("react"));var D=p(a("react")),k=a("ink"),ro=()=>D.default.createElement(k.Box,{flexDirection:"column",alignItems:"flex-start",justifyContent:"flex-start",borderColor:"greenBright",borderStyle:"double",padding:1},D.default.createElement(k.Text,{color:"cyanBright"},"refine v4 is released \u{1F389} You can upgrade to v4 with a single command without hassle!"),D.default.createElement(k.Newline,null),D.default.createElement(k.Text,{color:"greenBright"},"\u2705 %100 Backwards compatible"),D.default.createElement(k.Text,{color:"greenBright"},"\u2705 Bring your own router"),D.default.createElement(k.Text,{color:"greenBright"},"\u2705 Reduced bundle size"),D.default.createElement(k.Text,{color:"greenBright"},"\u2705 More consistent API"),D.default.createElement(k.Newline,null),D.default.createElement(k.Text,null,"See the migration guide here: https://refine.dev/docs/migration-guide/3x-to-4x")),Ht=ro;var qt=a("ink"),oo=()=>(0,qt.render)(Jt.default.createElement(Ht,null)),Xt=oo;var no=()=>{let e;try{e=X()}catch{console.error("The `package.json` file required to run could not be found."),process.exit(1)}let t=new Yt.Command;t.version(e.version,"-v, --version","Output the current version.").description(Kt.default.textSync("refine",{font:"Isometric1",horizontalLayout:"full",verticalLayout:"full",whitespaceBreak:!0})).usage("<command> [options]").helpOption("-h, --help","Output usage information."),Dt(t),Qe(t),at(t),Ce(t),Ee(t),Te(t),Ie(t),We(t),rt(t),t.hook("postAction",r=>{let n=r.args[0];Xt(),!["run"].includes(n)&&Wt()}),t.parse(process.argv),process.argv.slice(2).length||t.outputHelp()};no();})();
//# sourceMappingURL=cli.js.map